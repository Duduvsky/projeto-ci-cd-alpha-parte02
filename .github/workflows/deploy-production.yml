name: Production ü•á Promote Staging on PR Merge

# Trigger: Roda apenas quando um c√≥digo novo chega na main
on:
  push:
    branches: [ "main" ]

jobs:
  promote-to-production:
    name: Promover Staging para Produ√ß√£o
    runs-on: ubuntu-latest
    steps:
      # 1. Faz o checkout do branch gh-pages, que √© o nosso branch de deploy
      - name: 1. Checkout do branch gh-pages
        uses: actions/checkout@v4
        with:
          ref: gh-pages

      # 2. Copia o arquivo de staging para a raiz (produ√ß√£o)
      - name: 2. Copiar staging/index.html para index.html
        run: |
          echo "Promovendo staging para produ√ß√£o..."
          cp staging/index.html index.html
      
      # 3. Faz o commit da promo√ß√£o e envia para o gh-pages
      - name: 3. Commit e Push da promo√ß√£o
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add index.html
          # Verifica se h√° mudan√ßas antes de commitar para evitar erro
          if ! git diff --staged --quiet; then
            git commit -m "feat: ‚ú® Promove staging para produ√ß√£o"
            git push
          else
            echo "Nenhuma mudan√ßa para promover."
          fi